<div style="font-family: Helvetica, sans-serif">
    <h2>CSS 2 JUCE</h2>

    <p>Instructions:</p>
    <ol>
        <li>Select something within your project</li>
        <li>Click 'run'</li>
        <li>Get C++ header for your JUCE GUI</li>
    </ol>

    <button id="run" onclick="run()">Run</button>
    <button id="clear" onclick="clearTextarea()">Clear</button>
    <div style="font-size: 12px">
        <p id="status"></p>
        <p id="errors" style="color: orangered"></p>
    </div>

    <div style="padding: 0.5rem; box-sizing: border-box">
        <textarea id="text" style="width: 100%; min-height: 150px" placeholder="Your header will go here..."></textarea>
    </div>

    <button id="save" onclick="saveToFile()">Save</button>
</div>
<script>
    /****** Helpful *******/
    function writeError(msg) {
        clearStatus();
        let ele = document.getElementById('errors');
        ele.textContent = msg;
    }
    function clearError() {
        let ele = document.getElementById('errors');
        ele.textContent = '';
    }
    function writeStatus(msg) {
        clearError();
        let ele = document.getElementById('status');
        ele.textContent = msg;
    }
    function clearStatus() {
        let ele = document.getElementById('status');
        ele.textContent = '';
    }
    function clearTextarea() {
        clearError();
        let ele = document.getElementById('text');
        ele.textContent = '';
    }
    function saveAs(text, filename) {
        var element = document.createElement('a');
        element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
        element.setAttribute('download', filename);

        element.style.display = 'none';
        document.body.appendChild(element);

        element.click();

        document.body.removeChild(element);
    }

    /****** Main ******/
    function run() {
        clearTextarea();
        writeStatus('Generating. Please wait, this may take a few seconds...');
        setTimeout(() => {
            parent.postMessage({ pluginMessage: { type: 'run' } }, '*');
        }, 50);
    }

    function saveToFile() {
        clearError();
        let ele = document.getElementById('text');
        const text = ele.textContent;
        if (text.length == 0) {
            writeError('No text to save!');
        } else {
            saveAs(text, 'CSS2JUCE.h');
        }
    }

    window.onmessage = event => {
        const { pluginMessage } = event.data;

        if (pluginMessage.type == 'output') {
            writeStatus('Finished!');
            let ele = document.getElementById('text');
            ele.textContent = pluginMessage.data;
            clearStatus();
        } else if (pluginMessage.type == 'noselection') {
            clearStatus();
            writeError('Nothing selected!');
        }
    };
</script>
